<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <ul id="messages"></ul>
  <div>
  <div>
    <button id="sign" style="width:150px">Sign In</button>
  </div>
  <div>
    <button id="deposit" style="width:150px">Deposit</button>
    <textarea id="deposit-token" placeholder="Token Id"></textarea>
    <textarea id="deposit-amount" placeholder="Amount"></textarea>
  </div>
  <div>
    <button id="withdraw" style="width:150px">Withdraw</button>
    <textarea id="withdraw-token" placeholder="Token Id"></textarea>
    <textarea id="withdraw-amount" placeholder="Amount"></textarea>
  </div>
  <div>
    <button id="get-return" style="width:150px">Get Return</button>
    <textarea id="get-return-pool-id" placeholder="Pool Id"></textarea>
    <textarea id="get-return-token" placeholder="Token Id"></textarea>
    <textarea id="get-return-amount" placeholder="Amount"></textarea>
  </div>
  <div>
    <button id="swap" style="width:150px">Swap</button>
    <textarea id="swap-pool-id" placeholder="Pool Id"></textarea>
    <textarea id="swap-token" placeholder="Token Id"></textarea>
    <textarea id="swap-amount" placeholder="Amount"></textarea>
  </div>
  <div>
    <button id="add-liquidity" style="width:150px">Add Liquidity</button>
    <textarea id="add-liquidity-pool-id" placeholder="Pool Id"></textarea>
    <textarea id="add-liquidity-token" placeholder="Token Id"></textarea>
    <textarea id="add-liquidity-amount" placeholder="Amount"></textarea>
  </div>
  <div>
    <button id="remove-liquidity" style="width:150px">Remove Liquidity</button>
    <textarea id="add-liquidity-pool-id" placeholder="Pool Id"></textarea>
    <textarea id="add-liquidity-token" placeholder="Token Id"></textarea>
    <textarea id="add-liquidity-amount" placeholder="Amount"></textarea>
  </div>
  <div>
  <script src="https://cdn.jsdelivr.net/npm/near-api-js@1.1.0/dist/near-api-js.js"></script>
  <script>
    // connect to NEAR
    const near = new nearApi.Near({
      keyStore: new nearApi.keyStores.BrowserLocalStorageKeyStore(),
      networkId: 'testnet',
      nodeUrl: 'https://rpc.testnet.near.org',
      walletUrl: 'https://wallet.testnet.near.org'
    });
    
    // connect to the NEAR Wallet
    const wallet = new nearApi.WalletConnection(near, 'my-app');

    // connect to a NEAR smart contract
    const contract = new nearApi.Contract(wallet.account(), 'dev-1665751360038-15697305691965', {
      viewMethods: ['get_pools'],
      changeMethods: ['get_balance_all_tokens']
    });

    const button = document.getElementById('sign');
    if (!wallet.isSignedIn()) {
      button.textContent = 'SignIn with NEAR'
    } else {
      contract.get_balance_all_tokens(
      { 
        args: { account: wallet.getAccountId() },
      }
        )
      .then(messages => {
        const ul = document.getElementById('messages');
        const li = document.createElement('li');
        li.textContent = `>> Your balances: ${messages}`;
        ul.appendChild(li);
      });
    }

    // call the getMessages view method
    contract.get_pools()
      .then(messages => {
        const ul = document.getElementById('messages');
        messages.forEach(message => {
          const li = document.createElement('li');
          li.textContent = `>> ID: ${message.id} -- tokens: ${message.tokens[0]} / ${message.tokens[1]} -- liquidity ${message.liquidity[0]} / ${message.liquidity[1]}`;
          ul.appendChild(li);
        })
      });

    // Either sign in or call the addMessage change method on button click
    document.getElementById('sign').addEventListener('click', () => {
      if (wallet.isSignedIn()) {
        wallet.signOut();
      } else {
        wallet.requestSignIn({
          contractId: 'dev-1665751360038-15697305691965',
          methodNames: ['get_pools', 'get_balance_all_tokens']
        });
      }
    });

    document.getElementById('add-liquidity').addEventListener('click', () => {

    });

    document.getElementById('remove-liquidity').addEventListener('click', () => {

    });

    document.getElementById('deposit').addEventListener('click', () => {
      
    });

    document.getElementById('withdraw').addEventListener('click', () => {
        
    });

    document.getElementById('get-return').addEventListener('click', () => {

    });

    document.getElementById('swap').addEventListener('click', () => {
        console.log(`contractId = ${contract.contractId}`);
    });
  </script>
</body>

</html>